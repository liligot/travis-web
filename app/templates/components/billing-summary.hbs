<div class='plan-overview'>
  <div class="flex flex--space-between flex--wrap">
    <section>
      <h3 class='plan-overview__header'> Overview </h3>
      <div class='plan'>
        {{#if this.isGithubTrial}}
          <p data-test-trial-message class="source plan-status-message">
            You're trialing Travis CI via your
            <ExternalLinkTo
              @href={{config-get "marketplaceEndpoint"}}
              class="billing-section-link"
            >
              Github Marketplace subscription.
            </ExternalLinkTo>
          </p>
        {{/if}}
        <div>
          <p class='plan-overview__name flex flex--v-center' data-test-plan-name>
            {{#if this.subscription.plan }}
              {{concat this.subscription.plan.name ' plan'}} 
            {{else}}
              Unknown plan
            {{/if}}
            {{#if this.isPending}}
              <span class="badge square">
                pending
              </span>
            {{else if this.isActive}}
              <span class="badge green square">
                active
              </span>
            {{else if this.isCanceled}}
              <span class="badge grey square">
                canceled
              </span>
            {{/if}}
          </p>
          <p class='plan-overview__description' data-test-plan-concurrency>
            {{#if this.subscription.plan}}
              {{pluralize this.subscription.plan.builds "concurrent job"}}
            {{else}}
              Unknown concurrent jobs
            {{/if}}
            <span data-test-plan-message='true' class='plan-overview__description--validity {{if this.isCanceled 'red'}}'>
              {{this.planMessage}} 
              {{#if (not this.isPending)}}
                {{moment-format this.subscription.validTo "MMMM D, YYYY"}}
              {{/if}}
            </span>
          </p>
        </div>
      </div>
    </section>
    <section>
      <div class='selected-plan__price'>
        <p class='selected-plan__price--total' data-test-plan-total='true'>
          Total:
        </p>
        {{#if this.subscription.plan }}
          {{#if this.subscription.isManual}}
            <ManualSubscriptionHelp />
          {{else}}
            <p class='selected-plan__price--large' data-test-price>
              {{format-currency this.price floor='true'}}
            </p>
          {{/if}}
        {{/if}}
        <span data-test-selected-plan-period='true' class='selected-plan__period'>
          {{if this.subscription.plan.annual '/year' '/month'}}
        </span>
      </div>
    </section>
  </div>
    {{#if this.isPending}}
      <span class="notice-banner--yellow" data-test-trial-running-out='true'>
        We are currently waiting for Stripe to finish processing your order.
      </span>
    {{/if}}
  <div class="flex manage-subscription-buttons">
    <div>
      {{#if this.resubscribeLoading}}
        <LoadingIndicator />
      {{else if (and this.subscription.isResubscribable this.account.hasSubscriptionPermissions)}}
        <button onClick={{action 'resubscribe'}} class='button--green' data-test-resubscribe-subscription='true'>
          resubscribe
        </button>
      {{else}}
        <button class='button--blue' data-test-change-subscription='true'>
          Change plan
        </button>
      {{/if}}
    </div>
    <div class='manage-subscription-buttons__cancel'>
      {{#if this.cancelSubscriptionLoading}}
        <LoadingIndicator />
      {{else if (and (not this.subscription.isCanceled) this.account.hasSubscriptionPermissions)}}
        <button onClick={{action 'cancelSubscription'}} class='button--white' data-test-cancel-subscription='true'>
          Cancel subscription
        </button>
      {{/if}}
    </div>
  </div>
</div>
<hr />
<BillingAddress @subscription={{this.subscription}} />
<PaymentDetails @subscription={{this.subscription}} />
<hr />